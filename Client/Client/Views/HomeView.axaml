<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="clr-namespace:Client.ViewModels"
             xmlns:templated="clr-namespace:Client.Controls.Templated"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             x:Class="Client.Views.HomeView"
             x:DataType="vm:HomeViewModel">

	<Design.DataContext>
		<!-- This only sets the DataContext for the previewer in an IDE,
		 to set the actual DataContext for runtime, set the DataContext property in code (look at App.axaml.cs) -->
		<vm:HomeViewModel />
	</Design.DataContext>

	<UserControl.Resources>
		<ResourceDictionary>
			<ResourceDictionary.MergedDictionaries>
				<ResourceInclude Source="/Resources/Geometries.axaml" />
				<ResourceInclude Source="/Resources/Colors.axaml" />
			</ResourceDictionary.MergedDictionaries>
		</ResourceDictionary>
	</UserControl.Resources>

	<UserControl.Styles>
		<StyleInclude Source="/Resources/Styles.axaml" />
		<StyleInclude Source="/Controls/Templated/OverlayPopup.axaml"/>
	</UserControl.Styles>

	<Border CornerRadius="15" Margin="6" Padding="15" x:Name="Border">
		<Border.Background>
			<LinearGradientBrush StartPoint="0%, 0%" EndPoint="100%, 100%">
				<GradientStop Offset="0" Color="{StaticResource Background0}" />
				<GradientStop Offset="1" Color="{StaticResource Background1}" />
			</LinearGradientBrush>
		</Border.Background>

		<Grid>
			<templated:OverlayPopup IsOpen="{Binding ForceOffWarningIsOpen}" 
			                        VerticalAlignment="Top" Placement="Center" PlacementTarget="Border" Background="White" Title="Warning"
			                        ClosedCommand="{Binding ForceOffWarningClosedCommand}">
			
				<StackPanel>
					<TextBlock TextWrapping="Wrap" Foreground="Black">
						A forced shutdown powers off the virtual machine without powering off the operating system. <LineBreak/>
						This action can damage the virtual machine, and cause data loss.
					</TextBlock>
					<TextBlock TextWrapping="Wrap" FontWeight="DemiBold" Margin="0, 5, 0, 15"
					           Text="{Binding ForceOffWarningQuestion}"/>
					
					<StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Spacing="10">
						<Button FontWeight="Bold" Foreground="#3a3a3a" Command="{Binding ForceOffWarningClosedCommand}">Cancel</Button>
						<Button FontWeight="Bold" Foreground="#3a3a3a" Command="{Binding ForceOffConfirmClickCommand}">Force Off</Button>
					</StackPanel>
				</StackPanel>
			</templated:OverlayPopup>
		
			<templated:OverlayPopup Title="Delete the Virtual Machine?" Background="White"
			                        Placement="Center" PlacementTarget="Border"
			                        IsOpen="{Binding DeleteVmPopupIsOpen}"
			                        ClosedCommand="{Binding DeletePopupClosedCommand}">
				
				<StackPanel Spacing="10">
					<TextBlock TextWrapping="Wrap" Foreground="Black" IsVisible="{Binding DeleteVmPopupHasDrives}">
						The virtual machine has drives connected to it.
					</TextBlock>
					<TextBlock TextWrapping="Wrap" FontWeight="DemiBold" IsVisible="{Binding DeleteVmPopupHasDrives}">
						Select the drives you would like to delete.
					</TextBlock>
					
					<ScrollViewer MaxHeight="350" IsVisible="{Binding DeleteVmPopupHasDrives}">
						<ItemsControl ItemsSource="{Binding DeleteVmPopupDrives}" Background="Transparent">
							<ItemsControl.ItemTemplate>
								<DataTemplate DataType="{x:Type vm:DeletionDriveItemTemplate}">
									<Border Background="#efefef" Padding="6" CornerRadius="10" Margin="0, 0, 0, 8">
										<StackPanel>
											<Grid ColumnDefinitions="4*, 5, 2*, 3*, Auto" VerticalAlignment="Center">

												<TextBlock VerticalAlignment="Center" Text="{Binding Name}" />

												<TextBlock Grid.Column="2" VerticalAlignment="Center"
												           FontWeight="DemiBold" Text="{Binding DriveTypeString}" />

												<TextBlock Grid.Column="3" VerticalAlignment="Center"
												           FontWeight="DemiBold" Text="{Binding SizeString}" />

												<CheckBox Grid.Column="4" Margin="10, 0, 0, 0"
												          IsChecked="{Binding IsMarkedForDeletion}" 
												          IsEnabled="{Binding !IsInUse}"/>
											</Grid>
											
											<TextBlock Classes="error" IsVisible="{Binding IsInUse}"
											           FontSize="13">
												Cannot delete drive, used by one or more virtual machines.
											</TextBlock>
										</StackPanel>
									</Border>
								</DataTemplate>
							</ItemsControl.ItemTemplate>
						</ItemsControl>
					</ScrollViewer>
				
					<TextBlock FontWeight="DemiBold" IsVisible="{Binding DeleteVmPopupHasDrives}" TextWrapping="Wrap">
						The selected drives and the virtual machine will be deleted. <LineBreak/>
						This action cannot be undone.
					</TextBlock>
					<TextBlock FontWeight="DemiBold" IsVisible="{Binding !DeleteVmPopupHasDrives}" TextWrapping="Wrap">
						The virtual machine will be deleted. <LineBreak/>
						This action cannot be undone.
					</TextBlock>
					
					<TextBlock FontWeight="Bold">Are you sure you want to continue?</TextBlock>
					
					<TextBlock Classes="error" IsVisible="{Binding DeleteVmPopupVmRunning}">
						Cannot delete a virtual machine while it is running.
					</TextBlock>
					
					<Button FontWeight="Bold" HorizontalAlignment="Center" FontSize="16" CornerRadius="8"
					        Margin="0, 5, 0, 0"
					        IsEnabled="{Binding !DeleteVmPopupVmRunning}"
					        Command="{Binding DeleteVmConfirmDeleteClickCommand}">
						Delete
					</Button>
				</StackPanel>
			</templated:OverlayPopup>
		
			<templated:OverlayPopup IsOpen="{Binding ConPopupIsOpen}" Width="450"
			                        PlacementTarget="Border" Background="White" Placement="Center"
			                        Title="Connected Drives"
			                        ClosedCommand="{Binding CloseConPopupCommand}">
				<StackPanel Spacing="10">
					<TextBlock TextWrapping="Wrap" FontWeight="DemiBold">Checked drives will be connected to this virtual machine.</TextBlock>

					<ScrollViewer MaxHeight="360">
						<ItemsControl ItemsSource="{Binding ConPopupDriveConnections}">
							<ItemsControl.DataTemplates>
								<DataTemplate DataType="vm:DriveConnectionItemTemplate">
									<Border CornerRadius="11" Background="#efefef" Padding="11, 7, 8, 7" Margin="6">
										<Grid ColumnDefinitions="2*, 1.5*, *, Auto" VerticalAlignment="Center">
											<TextBlock VerticalAlignment="Center" Text="{Binding Name}" FontWeight="DemiBold" />
											<TextBlock Grid.Column="1" VerticalAlignment="Center" Text="{Binding Size}" FontWeight="DemiBold" />
											<TextBlock Grid.Column="2" VerticalAlignment="Center" Text="{Binding DriveType}" FontWeight="DemiBold" />

											<CheckBox Grid.Column="3" VerticalAlignment="Center"
											          IsChecked="{Binding IsChecked}" />
										</Grid>
									</Border>
								</DataTemplate>
							</ItemsControl.DataTemplates>
						</ItemsControl>
					</ScrollViewer>
			
					<TextBlock TextWrapping="Wrap">For running virtual machines, changes will take effect after the next shutdown.</TextBlock>
				
					<Button CornerRadius="8" FontSize="16" FontWeight="Bold" Margin="0, 4, 0, 0" 
					        HorizontalAlignment="Center"
					        Command="{Binding ConPopupApplyClickCommand}">
						Apply
					</Button>
				</StackPanel>
			</templated:OverlayPopup>
			
			<ScrollViewer AllowAutoHide="False">
				<StackPanel>
					<ItemsControl ItemsSource="{Binding Vms}" Background="Transparent">
						<ItemsControl.ItemsPanel>
							<ItemsPanelTemplate>
								<WrapPanel Orientation="Horizontal" />
							</ItemsPanelTemplate>
						</ItemsControl.ItemsPanel>

						<ItemsControl.ItemTemplate>
							<DataTemplate DataType="{x:Type vm:VmItemTemplate}">
								<Border CornerRadius="10" Padding="10" Margin="10" BorderThickness="0" BorderBrush="#5f757a"
								        Width="230" Height="200" BoxShadow="0 0 15 0 #c9d6d3">
									<Border.Background>
										<LinearGradientBrush StartPoint="0%, 0%" EndPoint="45%, 45%">
											<!-- <GradientStop Offset="0" Color="#f7fdff" /> -->
											<!-- <GradientStop Offset="1" Color="#eff9f9" /> -->
											<GradientStop Offset="0" Color="#f9fdff" />
											<GradientStop Offset="1" Color="#f2f9f9" />
										</LinearGradientBrush>
									</Border.Background>

									<Grid RowDefinitions="Auto, *, Auto">
										<StackPanel VerticalAlignment="Top" Spacing="5">
											<Grid ColumnDefinitions="*, Auto">
												<TextBlock FontSize="16" Foreground="#4f5b5b" VerticalAlignment="Center"
												           Text="{Binding OperatingSystemString}" />

												<Button Grid.Column="1" Padding="4" VerticalAlignment="Center" Background="#c3dae8" Opacity="0.78">
													<PathIcon Data="{StaticResource CaretDownRegular}" Width="16" Height="16" />
													<Button.Flyout>
														<MenuFlyout VerticalOffset="5">
															<MenuItem Header="Force off" Command="{Binding ForceOffClickCommand}" />
															<MenuItem Header="Manage connected drives" Command="{Binding ManageDriveConnectionsClickCommand}" />
															<MenuItem Header="Delete" Command="{Binding DeleteClickCommand}" />
														</MenuFlyout>
													</Button.Flyout>
												</Button>
											</Grid>
											<TextBlock FontSize="16" Foreground="#4f5b5b" Text="{Binding Name}" />
											<TextBlock FontSize="16" Foreground="{Binding StateColor}" Text="{Binding StateString}" FontWeight="Bold" />
										</StackPanel>

										<StackPanel Grid.Row="1" Orientation="Horizontal" Spacing="20" IsVisible="{Binding ErrorMessageIsVisible}">
											<TextBlock Classes="error" Text="{Binding ErrorMessage}" VerticalAlignment="Center" />

											<Button Command="{Binding ErrorMessageDismissCommand}" Background="Transparent" VerticalAlignment="Center">
												<PathIcon Data="{StaticResource DismissRegular}" Width="10" Height="10" />
											</Button>
										</StackPanel>

										<StackPanel Grid.Row="2" HorizontalAlignment="Center" Spacing="5" VerticalAlignment="Bottom">
											<Button HorizontalAlignment="Center" Command="{Binding OpenClickCommand}" Classes="vm_action">
												Open
											</Button>

											<StackPanel Orientation="Horizontal" Spacing="10">
												<Button Width="80" Command="{Binding PowerOnClickCommand}" Classes="vm_action">
													Start
												</Button>

												<Button Command="{Binding PowerOffClickCommand}" Classes="vm_action">
													Power Off
												</Button>
											</StackPanel>
										</StackPanel>
									</Grid>
								</Border>
							</DataTemplate>
						</ItemsControl.ItemTemplate>
					</ItemsControl>
				</StackPanel>
			</ScrollViewer>
		</Grid>
	</Border>
</UserControl>